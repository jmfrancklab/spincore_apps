

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>CPMG with microwaves &mdash; spincore_apps 0.9 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../_static/gallery_custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Automated Combined DNP with Log" href="combined_ODNP.html" />
    <link rel="prev" title="Field Sweep at constant power" href="run_field_dep_justMw.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> spincore_apps
          

          
          </a>

          
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">SpinCore Example Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="adc_offset.html">Calculate ADC offset</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ep_spacing.html">Generate an appropriately spaced power axis for a progressive saturation</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_test.html">Test Run</a></li>
<li class="toctree-l2"><a class="reference internal" href="basic_config_example.html">Example of how the configuration file is called and used</a></li>
<li class="toctree-l2"><a class="reference internal" href="save_data_example.html">test of logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="gds_for_tune.html">GDS for tune</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_Hahn_echo.html">Spin Echo</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_nutation.html">Nutation</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_CPMG.html">CPMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_var_tau.html">Varied Tau Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_IR.html">Run Inversion Recovery at set power</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_T1CPMG.html">T1CPMG</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_progressive_saturation.html">Run an Enhancement Experiment</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_CPMG_calib.html">CPMG_calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_field_dep_justMw.html">Field Sweep at constant power</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">CPMG with microwaves</a></li>
<li class="toctree-l2"><a class="reference internal" href="combined_ODNP.html">Automated Combined DNP with Log</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Lowest level</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#first-level-in-this-repo">First level in this repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#second-level-in-this-repo">Second level in this repo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro.html#top-level">Top level</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">spincore_apps</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../intro.html">Lowest level</a> &raquo;</li>
        
          <li><a href="index.html">SpinCore Example Gallery</a> &raquo;</li>
        
      <li>CPMG with microwaves</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/auto_examples/run_CPMG_mw.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-run-cpmg-mw-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</aside>
<section class="sphx-glr-example-title" id="cpmg-with-microwaves">
<span id="sphx-glr-auto-examples-run-cpmg-mw-py"></span><h1>CPMG with microwaves<a class="headerlink" href="#cpmg-with-microwaves" title="Permalink to this headline">¶</a></h1>
<p>Standard CPMG experiment with microwaves on.</p>
<p>FOR PHASE CYCLING: Provide both a phase cycle label (e.g.,
‘ph1’, ‘ph2’) as str and an array containing the indices
(i.e., registers) of the phases you which to use that are
specified in the numpy array ‘tx_phases’.  Note that
specifying the same phase cycle label will loop the
corresponding phase steps together, regardless of whether
the indices are the same or not.</p>
<blockquote>
<div><p>e.g.,
The following:</p>
<blockquote>
<div><p>(‘pulse’,2.0,’ph1’,r_[0,1]),
(‘delay’,1.5),
(‘pulse’,2.0,’ph1’,r_[2,3]),</p>
</div></blockquote>
<dl class="simple">
<dt>will provide two transients with phases of the two pulses (p1,p2):</dt><dd><p>(0,2)
(1,3)</p>
</dd>
<dt>whereas the following:</dt><dd><p>(‘pulse’,2.0,’ph1’,r_[0,1]),
(‘delay’,1.5),
(‘pulse’,2.0,’ph2’,r_[2,3]),</p>
</dd>
<dt>will provide four transients with phases of the two pulses (p1,p2):</dt><dd><p>(0,2)
(0,3)
(1,2)
(1,3)</p>
</dd>
</dl>
</div></blockquote>
<p>FURTHER: The total number of transients that will be
collected are determined by both nScans (determined when
calling the appropriate marker) and the number of steps
calculated in the phase cycle as shown above.  Thus for
nScans = 1, the SpinCore will trigger 2 times in the first
case and 4 times in the second case.  for nScans = 2, the
SpinCore will trigger 4 times in the first case and 8 times
in the second case.</p>
<div class="sphx-glr-script-out highlight-pytb notranslate"><div class="highlight"><pre><span></span><span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;C:\Users\Alex Guinness\gitstuff\spincore_apps\examples\run_CPMG_mw.py&quot;</span>, line <span class="m">44</span>, in <span class="n">&lt;module&gt;</span>
    <span class="kn">import</span> <span class="nn">SpinCore_pp</span>
  File <span class="nb">&quot;C:\Users\Alex Guinness\gitstuff\spincore_apps\Spincore_pp\SpinCore_pp.py&quot;</span>, line <span class="m">17</span>, in <span class="n">&lt;module&gt;</span>
    <span class="n">_SpinCore_pp</span> <span class="o">=</span> <span class="n">swig_import_helper</span><span class="p">()</span>
  File <span class="nb">&quot;C:\Users\Alex Guinness\gitstuff\spincore_apps\Spincore_pp\SpinCore_pp.py&quot;</span>, line <span class="m">16</span>, in <span class="n">swig_import_helper</span>
    <span class="k">return</span> <span class="n">importlib</span><span class="o">.</span><span class="n">import_module</span><span class="p">(</span><span class="s1">&#39;_SpinCore_pp&#39;</span><span class="p">)</span>
  File <span class="nb">&quot;C:\ProgramData\Anaconda3\lib\importlib\__init__.py&quot;</span>, line <span class="m">127</span>, in <span class="n">import_module</span>
    <span class="k">return</span> <span class="n">_bootstrap</span><span class="o">.</span><span class="n">_gcd_import</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="n">level</span><span class="p">:],</span> <span class="n">package</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span>
<span class="gr">ModuleNotFoundError</span>: <span class="n">No module named &#39;_SpinCore_pp&#39;</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pylab</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pyspecdata</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">SpinCore_pp</span>
<span class="kn">from</span> <span class="nn">Instruments</span> <span class="kn">import</span> <span class="n">Bridge12</span><span class="p">,</span> <span class="n">prologix_connection</span><span class="p">,</span> <span class="n">gigatronics</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">h5py</span>

<span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
    <span class="s2">&quot;This pulse proram has not been updated.  Before running again, it should be possible to replace a lot of the code below with a call to the function provided by the &#39;generic&#39; pulse program inside the ppg directory!&quot;</span>
<span class="p">)</span>

<span class="n">fl</span> <span class="o">=</span> <span class="n">figlist_var</span><span class="p">()</span>
<span class="c1"># {{{importing acquisition parameters</span>
<span class="n">config_dict</span> <span class="o">=</span> <span class="n">SpinCore_pp</span><span class="o">.</span><span class="n">configuration</span><span class="p">(</span><span class="s2">&quot;active.ini&quot;</span><span class="p">)</span>
<span class="n">nPoints</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;SW_kHz&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{create filename and save to config file</span>
<span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cpmg_mw&quot;</span>
<span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">date</span>
<span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;cpmg_counter&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;chemical&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">config_dict</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{set phase cycling</span>
<span class="n">phase_cycling</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="n">phase_cycling</span><span class="p">:</span>
    <span class="n">ph1_cyc</span> <span class="o">=</span> <span class="n">r_</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
    <span class="n">nPhaseSteps</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">phase_cycling</span><span class="p">:</span>
    <span class="n">ph1_cyc</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">nPhaseSteps</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{power settings</span>
<span class="n">dB_settings</span> <span class="o">=</span> <span class="n">gen_powerlist</span><span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;max_power&quot;</span><span class="p">],</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;power_steps&quot;</span><span class="p">])</span>
<span class="n">append_dB</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">dB_settings</span><span class="p">[</span>
        <span class="nb">abs</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dB_settings</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;max_power&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">frac</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">frac</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">dB_settings</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">dB_settings</span><span class="p">,</span> <span class="n">append_dB</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dB_settings&quot;</span><span class="p">,</span> <span class="n">dB_settings</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;correspond to powers in Watts&quot;</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dB_settings</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="o">-</span> <span class="mi">3</span><span class="p">))</span>
<span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Look ok?&quot;</span><span class="p">)</span>
<span class="n">powers</span> <span class="o">=</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">dB_settings</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">)</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{make better tau</span>
<span class="n">marker</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">tau_extra</span> <span class="o">=</span> <span class="mf">5000.0</span>  <span class="c1"># us, must be more than deadtime and more than deblank</span>
<span class="n">pad_start</span> <span class="o">=</span> <span class="n">tau_extra</span> <span class="o">-</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]</span>
<span class="n">pad_end</span> <span class="o">=</span> <span class="n">tau_extra</span> <span class="o">-</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>  <span class="c1"># marker + deblank</span>
<span class="n">twice_tau</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]</span>
    <span class="o">+</span> <span class="n">pad_start</span>
    <span class="o">+</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e3</span>
    <span class="o">+</span> <span class="n">pad_end</span>
    <span class="o">+</span> <span class="n">marker</span>
<span class="p">)</span>
<span class="n">tau_us</span> <span class="o">=</span> <span class="n">twice_tau</span> <span class="o">/</span> <span class="mf">2.0</span>
<span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;tau_us&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tau_us</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{run CPMG</span>
<span class="n">cpmg_data</span> <span class="o">=</span> <span class="n">generic</span><span class="p">(</span>
    <span class="n">ppg_list</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;phase_reset&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="s2">&quot;ph1&quot;</span><span class="p">,</span> <span class="n">ph1_cyc</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;tau_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_start_us</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;acquire&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_end_us</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;marker&quot;</span><span class="p">,</span> <span class="s2">&quot;echo_label&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nEchoes&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>  <span class="c1"># 1 us delay</span>
        <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_start_us</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;acquire&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_end_us</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;jumpto&quot;</span><span class="p">,</span> <span class="s2">&quot;echo_label&quot;</span><span class="p">),</span>  <span class="c1"># 1 us delay</span>
        <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;repetition_us&quot;</span><span class="p">]),</span>
    <span class="p">],</span>
    <span class="n">nScans</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">],</span>
    <span class="n">indirect_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">indirect_len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">adcOffset</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;adc_offset&quot;</span><span class="p">],</span>
    <span class="n">carrierFreq_MHz</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;carrierFreq_MHz&quot;</span><span class="p">],</span>
    <span class="n">nPoints</span><span class="o">=</span><span class="n">nPoints</span><span class="p">,</span>
    <span class="n">SW_kHz</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;SW_kHz&quot;</span><span class="p">],</span>
    <span class="n">ret_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">raw_input</span><span class="p">(</span><span class="s2">&quot;CONNECT AND TURN ON BRIDGE12...&quot;</span><span class="p">)</span>
<span class="k">with</span> <span class="n">Bridge12</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
    <span class="n">b</span><span class="o">.</span><span class="n">set_wg</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">set_rf</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">set_amp</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">this_return</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">lock_on_dip</span><span class="p">(</span>
        <span class="n">ini_range</span><span class="o">=</span><span class="p">(</span>
            <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;uw_dip_center_GHz&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;uw_dip_width_GHz&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;uw_dip_center_GHz&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;uw_dip_width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">dip_f</span> <span class="o">=</span> <span class="n">this_return</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">,</span> <span class="n">dip_f</span><span class="p">)</span>
    <span class="n">b</span><span class="o">.</span><span class="n">set_freq</span><span class="p">(</span><span class="n">dip_f</span><span class="p">)</span>
    <span class="n">meter_powers</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">dB_settings</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">this_power</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dB_settings</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** *** *** *** ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;SETTING THIS POWER&quot;</span><span class="p">,</span> <span class="n">this_power</span><span class="p">,</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="n">dB_settings</span><span class="p">[</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">powers</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="s2">&quot;W)&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">this_power</span> <span class="o">&gt;</span> <span class="n">last_power</span> <span class="o">+</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">last_power</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SETTING TO...&quot;</span><span class="p">,</span> <span class="n">last_power</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">last_power</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">this_power</span> <span class="o">&gt;</span> <span class="n">last_power</span> <span class="o">+</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">last_power</span> <span class="o">+=</span> <span class="mi">3</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SETTING TO...&quot;</span><span class="p">,</span> <span class="n">last_power</span><span class="p">)</span>
                <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">last_power</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FINALLY - SETTING TO DESIRED POWER&quot;</span><span class="p">)</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">this_power</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">j</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">threshold_power</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">this_power</span> <span class="o">&gt;</span> <span class="n">threshold_power</span><span class="p">:</span>
                <span class="n">next_power</span> <span class="o">=</span> <span class="n">threshold_power</span> <span class="o">+</span> <span class="mi">3</span>
                <span class="k">while</span> <span class="n">next_power</span> <span class="o">&lt;</span> <span class="n">this_power</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SETTING To...&quot;</span><span class="p">,</span> <span class="n">next_power</span><span class="p">)</span>
                    <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">next_power</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">3.0</span><span class="p">)</span>
                    <span class="n">next_power</span> <span class="o">+=</span> <span class="mi">3</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">this_power</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">b</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">this_power</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">prologix_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">p</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">gigatronics</span><span class="p">(</span><span class="n">prologix_instance</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">address</span><span class="o">=</span><span class="mi">7</span><span class="p">)</span> <span class="k">as</span> <span class="n">g</span><span class="p">:</span>
                <span class="n">meter_powers</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">read_power</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;POWER READING&quot;</span><span class="p">,</span> <span class="n">meter_powers</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">generic</span><span class="p">(</span>
            <span class="n">ppg_list</span><span class="o">=</span><span class="p">[</span>
                <span class="p">(</span><span class="s2">&quot;phase_reset&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="s2">&quot;ph1&quot;</span><span class="p">,</span> <span class="n">ph1_cyc</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;tau_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_start_us</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;acquire&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_end_us</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;marker&quot;</span><span class="p">,</span> <span class="s2">&quot;echo_label&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nEchoes&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>  <span class="c1"># 1 us delay</span>
                <span class="p">(</span><span class="s2">&quot;delay_TTL&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deblank_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;pulse_TTL&quot;</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;p90_us&quot;</span><span class="p">],</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;deadtime_us&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_start_us</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;acquire&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;acq_time_ms&quot;</span><span class="p">]),</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">pad_end_us</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;jumpto&quot;</span><span class="p">,</span> <span class="s2">&quot;echo_label&quot;</span><span class="p">),</span>  <span class="c1"># 1 us delay</span>
                <span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;repetition_us&quot;</span><span class="p">]),</span>
            <span class="p">],</span>
            <span class="n">nScans</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">],</span>
            <span class="n">indirect_idx</span><span class="o">=</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">indirect_len</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
            <span class="n">adcOffset</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;adc_offset&quot;</span><span class="p">],</span>
            <span class="n">carrierFreq_MHz</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;carrierFreq_MHz&quot;</span><span class="p">],</span>
            <span class="n">nPoints</span><span class="o">=</span><span class="n">nPoints</span><span class="p">,</span>
            <span class="n">SW_kHz</span><span class="o">=</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;SW_kHz&quot;</span><span class="p">],</span>
            <span class="n">indirect_fileds</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;p90_idx&quot;</span><span class="p">,</span> <span class="s2">&quot;p90_us&quot;</span><span class="p">),</span>
            <span class="n">ret_data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">last_power</span> <span class="o">=</span> <span class="n">this_power</span>
<span class="c1"># }}}</span>
<span class="c1"># {{{ chunk and save data</span>
<span class="k">if</span> <span class="n">phase_cycling</span><span class="p">:</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ph1&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">],</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">ph1_cyc</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">setaxis</span><span class="p">(</span><span class="s2">&quot;ph1&quot;</span><span class="p">,</span> <span class="n">ph1_cyc</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cpmg_data</span><span class="o">.</span><span class="n">setaxis</span><span class="p">(</span><span class="s2">&quot;nScans&quot;</span><span class="p">,</span> <span class="n">r_</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">]])</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">reorder</span><span class="p">([</span><span class="s2">&quot;ph1&quot;</span><span class="p">,</span> <span class="s2">&quot;nScans&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">])</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">set_units</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s2">&quot;Raw - time&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">cpmg_data</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;nScans&quot;</span><span class="p">))</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">for_plot</span> <span class="o">=</span> <span class="n">cpmg_data</span><span class="o">.</span><span class="n">C</span>
    <span class="n">for_plot</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">for_plot</span><span class="o">.</span><span class="n">ft</span><span class="p">([</span><span class="s2">&quot;ph1&quot;</span><span class="p">],</span> <span class="n">unitary</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s2">&quot;FTed data&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">for_plot</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;nScans&quot;</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">cpmg_data</span><span class="o">.</span><span class="n">setaxis</span><span class="p">(</span><span class="s2">&quot;nScans&quot;</span><span class="p">,</span> <span class="n">r_</span><span class="p">[</span><span class="mi">0</span> <span class="p">:</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;nScans&quot;</span><span class="p">]])</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;t2&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s2">&quot;Raw - time&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">cpmg_data</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;nScans&quot;</span><span class="p">))</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">reorder</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">for_plot</span> <span class="o">=</span> <span class="n">cpmg_data</span><span class="o">.</span><span class="n">C</span>
    <span class="n">for_plot</span><span class="o">.</span><span class="n">ft</span><span class="p">(</span><span class="s2">&quot;t2&quot;</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">next</span><span class="p">(</span><span class="s2">&quot;FTed data&quot;</span><span class="p">)</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">for_plot</span><span class="p">)</span>
<span class="n">cpmg_data</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;type&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;cpmg_counter&quot;</span><span class="p">])</span>
<span class="n">cpmg_data</span><span class="o">.</span><span class="n">set_prop</span><span class="p">(</span><span class="s2">&quot;acq_params&quot;</span><span class="p">,</span> <span class="n">config_dict</span><span class="o">.</span><span class="n">asdict</span><span class="p">())</span>
<span class="n">target_directory</span> <span class="o">=</span> <span class="n">getDATADIR</span><span class="p">(</span><span class="n">exp_type</span><span class="o">=</span><span class="s2">&quot;ODNP_NMR_comp/CPMG&quot;</span><span class="p">)</span>
<span class="n">filename_out</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.h5&quot;</span>
<span class="n">nodename</span> <span class="o">=</span> <span class="n">cpmg_data</span><span class="o">.</span><span class="n">name</span><span class="p">()</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this file already exists so we will add a node to it!&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span>
        <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_directory</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
    <span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">nodename</span> <span class="ow">in</span> <span class="n">fp</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;this nodename already exists, so I will call it temp_cpmg_mw&quot;</span><span class="p">)</span>
            <span class="n">cpmg_data</span><span class="o">.</span><span class="n">name</span><span class="p">(</span><span class="s2">&quot;temp_cpmg_mw&quot;</span><span class="p">)</span>
            <span class="n">nodename</span> <span class="o">=</span> <span class="s2">&quot;temp_cpmg_mw&quot;</span>
    <span class="n">cpmg_data</span><span class="o">.</span><span class="n">hdf5_write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">target_directory</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cpmg_data</span><span class="o">.</span><span class="n">hdf5_write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename_out</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">directory</span><span class="o">=</span><span class="n">target_directory</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;I had problems writing to the correct file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.h5, so I&#39;m going to try to save your file to temp_cpmg_mw.h5 in the current directory&quot;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;temp_cpmg_mw.h5&quot;</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;there is a temp_cpmg_mw.h5 already! -- I&#39;m removing it&quot;</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;temp.h5&quot;</span><span class="p">)</span>
            <span class="n">cpmg_data</span><span class="o">.</span><span class="n">hdf5_write</span><span class="p">(</span><span class="s2">&quot;temp_spmg_mw.h5&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;if I got this far, that probably worked -- be sure to move/rename temp_cpmg_mw.h5 to the correct name!!&quot;</span>
            <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*** FILE SAVED IN TARGET DIRECTORY ***</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="s2">&quot;Name of saved data&quot;</span><span class="p">,</span> <span class="n">echo_data</span><span class="o">.</span><span class="n">name</span><span class="p">()))</span>
<span class="n">config_dict</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
<span class="n">fl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 0 minutes  0.012 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-run-cpmg-mw-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e7e9cc477677f6a7384936375118f192/run_CPMG_mw.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">run_CPMG_mw.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/cb58537977b25f2c6bd1086df1b8d00d/run_CPMG_mw.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">run_CPMG_mw.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="combined_ODNP.html" class="btn btn-neutral float-right" title="Automated Combined DNP with Log" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="run_field_dep_justMw.html" class="btn btn-neutral float-left" title="Field Sweep at constant power" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2023, John M. Franck group

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>